<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Dungarpur Live News</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{background:#f7f7f7;color:#222;overflow-x:hidden;}

header{
  background:#fff;padding:12px 15px;border-bottom:3px solid #d60000;
  position:sticky;top:0;z-index:999;
  display:flex;justify-content:space-between;align-items:center;
}
.logo{font-size:20px;font-weight:800;color:#d60000;display:flex;align-items:center;}

.live-dot{width:10px;height:10px;background:red;border-radius:50%;margin-left:6px;animation:blink .8s infinite;}
@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}

.time-box{font-size:12px;font-weight:600;color:#444;text-align:right;}

.hero{margin:15px auto;width:100%;padding:0 10px;}
.hero-left{width:100%;height:230px;background-size:cover;background-position:center;border-radius:12px;position:relative;}
.hero-left .text{position:absolute;bottom:0;width:100%;padding:15px;background:linear-gradient(transparent,rgba(0,0,0,0.9));border-radius:0 0 12px 12px;}
.hero-left h2{font-size:18px;font-weight:800;color:#fff;line-height:22px;}

.section-title{font-size:18px;font-weight:700;margin:20px 12px 10px;border-left:5px solid #d60000;padding-left:10px;}

.grid{display:grid;grid-template-columns:1fr;gap:15px;padding:0 12px;}
.card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 3px 6px rgba(0,0,0,0.1);cursor:pointer;}
.card img{width:100%;height:190px;object-fit:cover;}
.card .content{padding:12px;}
.card h3{font-size:16px;color:#d60000;font-weight:700;}
.card p{font-size:13px;margin-top:5px;color:#444;}

footer{background:#111;color:#ccc;text-align:center;padding:12px;font-size:12px;margin-top:20px;}

/* POPUP */
.popup-bg{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.8);display:none;justify-content:center;
  align-items:center;z-index:9999;padding:20px;
}
.popup-box{
  background:#000;width:100%;max-width:450px;border-radius:12px;
  padding:10px;position:relative;
}
.popup-close{
  position:absolute;top:-10px;right:-10px;background:#d60000;
  color:#fff;border:none;font-size:20px;font-weight:700;
  width:32px;height:32px;border-radius:50%;cursor:pointer;
}
.popup-video{width:100%;height:260px;border-radius:10px;border:none;}
</style>
</head>
<body>

<header>
  <div class="logo">Dungarpur Live News <div class="live-dot"></div></div>
  <div class="time-box">
    <span id="live-date"></span><br>
    <span id="live-time"></span>
  </div>
</header>

<script>
function updateDateTime(){
  const now = new Date();
  document.getElementById('live-date').innerText =
    now.getDate()+" "+now.toLocaleString('en-US',{month:'short'})+" "+now.getFullYear();
  document.getElementById('live-time').innerText =
    now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}
setInterval(updateDateTime,1000);updateDateTime();
</script>

<div class="hero">
  <div class="hero-left" id="heroImg">
    <div class="text"><h2 id="heroTitle">Loading...</h2></div>
  </div>
</div>

<h2 class="section-title">Latest Video News</h2>
<div class="grid" id="newsGrid"></div>

<footer>© 2025 Dungarpur Live News</footer>

<!-- POPUP -->
<div class="popup-bg" id="popup">
  <div class="popup-box">
    <button class="popup-close" onclick="closePopup()">×</button>
    <iframe id="video-frame" class="popup-video" allowfullscreen></iframe>
  </div>
</div>

<script>
function openPopup(video){
  const embed = video.replace("watch?v=", "embed/") + "?autoplay=1";
  document.getElementById("video-frame").src = embed;
  document.getElementById("popup").style.display = "flex";
}
function closePopup(){
  document.getElementById("popup").style.display = "none";
  document.getElementById("video-frame").src = "";
}
</script>

<!-- LOAD SHEET -->
<script>
const sheetURL =
 "https://docs.google.com/spreadsheets/d/1XJ8pFXSaWjukPMk8aB2XD3v8mINjoV9n3QqnF02aa-Q/gviz/tq?tqx=out:json";

let allNews = [];
let loaded = 0;
const batch = 6;

function loadBatch(){
  let grid = document.getElementById("newsGrid");
  let slice = allNews.slice(loaded, loaded + batch);

  slice.forEach(n=>{
    grid.innerHTML += `
      <div class="card" onclick="openPopup('${n.video}')">
        <img src="${n.thumb}">
        <div class="content">
          <h3>${n.title}</h3>
          <p>${n.desc.substring(0,80)}...</p>
        </div>
      </div>`;
  });

  loaded += batch;
}

window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 200){
    loadBatch();
  }
});

fetch(sheetURL)
  .then(r=>r.text())
  .then(txt=>{
    let json = JSON.parse(txt.substring(txt.indexOf("{"), txt.lastIndexOf("}")+1));
    let rows = json.table.rows;

    rows.forEach(r=>{
      let type = r.c[0]?.v || "";
      let title = r.c[1]?.v || "";
      let desc = r.c[2]?.v || "";
      let video = r.c[3]?.v || "";
      let thumb = r.c[4]?.v ||
        `https://img.youtube.com/vi/${video.split("v=")[1]}/hqdefault.jpg`;

      if(type === "hero"){
        document.getElementById("heroImg").style.backgroundImage = `url('${thumb}')`;
        document.getElementById("heroTitle").innerText = title;
        document.getElementById("heroImg").onclick = ()=>openPopup(video);
      } 
      else if(type === "news"){
        allNews.push({title, desc, video, thumb});
      }
    });

    loadBatch();
  });
</script>

</body>
</html>
