<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Dungarpur Live News - Shorts</title>

<style>
    body {
        margin: 0;
        background: #000;
        font-family: Arial, sans-serif;
        overflow-x: hidden;
    }

    .video-container {
        height: 100vh;
        width: 100%;
        scroll-snap-align: start;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #000;
    }

    iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    #feed {
        height: 100vh;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
    }
</style>
</head>

<body>

<div id="feed"></div>

<script>
// ===============================
// GOOGLE SHEET PUBLIC JSON URL
// ===============================
const SHEET_URL =
  "https://opensheet.elk.sh/1GquTnPchH6HwDfCjJzq9ePbLsdvY4EAvhWkdyZq76iA/Sheet1";

let videos = [];
let index = 0;
const feed = document.getElementById("feed");

// ===============================
// SHORTS URL â†’ EMBED URL CONVERTER
// ===============================
function convertToEmbed(url) {
    if (url.includes("shorts")) {
        let id = url.split("/shorts/")[1].split("?")[0];
        return `https://www.youtube.com/embed/${id}`;
    }
    if (url.includes("watch?v=")) {
        let id = url.split("v=")[1];
        return `https://www.youtube.com/embed/${id}`;
    }
    return url;
}

// ===============================
// LOAD INITIAL VIDEOS
// ===============================
async function loadVideos() {
    const res = await fetch(SHEET_URL);
    const data = await res.json();
    videos = data.map(x => convertToEmbed(x.link));

    loadMore();
}

// ===============================
// LOAD NEXT 5 VIDEOS (INFINITE SCROLL)
// ===============================
function loadMore() {
    for (let i = 0; i < 5 && index < videos.length; i++) {
        const div = document.createElement("div");
        div.className = "video-container";

        div.innerHTML = `
            <iframe 
                src="${videos[index]}?autoplay=1&mute=1"
                allow="autoplay; encrypted-media"
                allowfullscreen>
            </iframe>
        `;

        feed.appendChild(div);
        index++;
    }
}

// ===============================
// AUTO LOAD WHEN REACH BOTTOM
// ===============================
feed.addEventListener("scroll", () => {
    if (feed.scrollTop + window.innerHeight >= feed.scrollHeight - 200) {
        loadMore();
    }
});

// ===============================
// TOUCH SWIPE (Up/Down)
// ===============================
let startY = 0;
feed.addEventListener("touchstart", e => {
    startY = e.touches[0].clientY;
});

feed.addEventListener("touchend", e => {
    let endY = e.changedTouches[0].clientY;
    let diff = startY - endY;

    if (diff > 50) feed.scrollBy(0, window.innerHeight);     // next
    else if (diff < -50) feed.scrollBy(0, -window.innerHeight); // previous
});

loadVideos();

</script>
</body>
</html>
